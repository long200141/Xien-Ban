<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Counter (Lưu Cache)</title>
    <style>
        :root {
            --primary: #4caf50;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #1c1e21;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 15px 10px 100px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 { color: var(--text); margin-bottom: 5px; font-size: 1.5rem; }
        .status { font-size: 0.8rem; color: #4caf50; margin-bottom: 15px; font-weight: bold; }

        .item-list { width: 100%; max-width: 450px; }

        .counter-item {
            background: var(--card);
            border-radius: 15px;
            padding: 12px 18px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .info { display: flex; flex-direction: column; flex: 1; }
        .name { font-weight: 600; font-size: 1.1rem; color: var(--text); }
        .price-tag { font-size: 0.9rem; color: #65676b; }

        .controls { display: flex; align-items: center; gap: 12px; }

        button {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: none;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        }

        .btn-minus { background-color: #f0f2f5; color: #444; }
        .btn-plus { background-color: var(--primary); color: white; }

        .count { font-size: 1.2rem; font-weight: 700; min-width: 30px; text-align: center; }

        .footer {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: #ffffff;
            border-top: 1px solid #ddd;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.05);
        }

        #totalPrice { font-size: 1.5rem; font-weight: 800; color: #e41e3f; }

        .reset-btn {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #c62828;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <h2>Phiếu Thu Tiền</h2>
    <div class="status">● Tự động lưu đã bật</div>
    
    <button class="reset-btn" onclick="resetAll()">Xóa tất cả (Làm mới)</button>

    <div class="item-list" id="itemList"></div>

    <div class="footer">
        <span style="color:#65676b">TỔNG CỘNG</span>
        <span id="totalPrice">0đ</span>
    </div>

    <script>
        // Dữ liệu gốc
        const defaultItems = [
            { id: 1, name: "Tôm", price: 2000, count: 0 },
            { id: 2, name: "Mực", price: 2000, count: 0 },
            { id: 3, name: "Chả cá", price: 500, count: 0 },
            { id: 4, name: "Xúc xích nhỏ", price: 2000, count: 0 },
            { id: 5, name: "Xúc xích to", price: 10000, count: 0 },
            { id: 6, name: "Hồ lô", price: 1000, count: 0 },
            { id: 7, name: "Phô mai viên", price: 2000, count: 0 },
            { id: 8, name: "Phô mai que", price: 4000, count: 0 },
            { id: 9, name: "Nem chua rán", price: 4000, count: 0 }
        ];

        let items = [];

        // 1. Hàm LOAD dữ liệu từ LocalStorage
        function loadData() {
            const saved = localStorage.getItem('myCounterData');
            if (saved) {
                items = JSON.parse(saved);
            } else {
                items = [...defaultItems];
            }
        }

        // 2. Hàm SAVE dữ liệu vào LocalStorage
        function saveData() {
            localStorage.setItem('myCounterData', JSON.stringify(items));
        }

        function formatMoney(amount) {
            return amount.toLocaleString('vi-VN') + 'đ';
        }

        function updateTotal() {
            const total = items.reduce((sum, item) => sum + (item.count * item.price), 0);
            document.getElementById('totalPrice').innerText = formatMoney(total);
        }

        function renderItems() {
            const itemListElement = document.getElementById('itemList');
            itemListElement.innerHTML = '';
            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'counter-item';
                itemDiv.innerHTML = `
                    <div class="info">
                        <span class="name">${item.name}</span>
                        <span class="price-tag">${formatMoney(item.price)}</span>
                    </div>
                    <div class="controls">
                        <button class="btn-minus" onclick="changeCount(${item.id}, -1)">−</button>
                        <span class="count" id="count-${item.id}">${item.count}</span>
                        <button class="btn-plus" onclick="changeCount(${item.id}, 1)">+</button>
                    </div>
                `;
                itemListElement.appendChild(itemDiv);
            });
        }

        window.changeCount = function(id, delta) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.count = Math.max(0, item.count + delta);
                document.getElementById(`count-${id}`).innerText = item.count;
                updateTotal();
                saveData(); // Lưu lại mỗi khi thay đổi
            }
        };

        window.resetAll = function() {
            if(confirm("Bạn muốn xóa sạch dữ liệu và làm lại từ đầu?")) {
                items = defaultItems.map(item => ({...item, count: 0}));
                saveData();
                renderItems();
                updateTotal();
            }
        }

        // Khởi chạy khi mở trang
        loadData();
        renderItems();
        updateTotal();
    </script>
</body>
</html>
